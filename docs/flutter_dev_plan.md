# EchoMind Flutter 客户端开发计划

## 1. 目标与范围
- 交付 iOS 优先的 Flutter 客户端，覆盖录音、实时字幕、录音库浏览、AI 查询、订阅购买等核心旅程。
- 整合现有 Speakr 后台 API，并扩展适配移动端认证、ASR 流式网关、用量统计等接口。
- 确保客户端可自托管部署下正常运行，满足隐私、安全、性能与可靠性指标。

## 2. 技术栈与基础设施
- Flutter 3.x，Dart 3.x；面向 iOS 首发，预留 Android 兼容抽象。
- 状态管理选型：探索 Riverpod + StateNotifier（便于模块化与依赖注入），配合 Freezed/Json Serializable 生成模型。
- 音频链路：使用 `flutter_sound` / `record` 进行麦克风采集，`just_audio` 播放；自研 WebSocket 客户端对接 faster-whisper 流式 ASR。
- 本地存储：Hive/Drift 缓存录音列表、会话历史、配置；依赖 secure storage 持久化 Token。
- 持续集成：Codemagic 或 GitHub Actions 构建流水线（格式化、静态分析、单元测试、集成测试、beta 分发）。

## 3. 里程碑与交付物
### 里程碑 A：Alpha（录音 + 实时字幕基础链路）
- 完成应用骨架，登录/登出、设备指纹、错误上报。
- 录音模块：前后台录音、断点保护、音频块上传与重试。
- 流式字幕渲染：处理 `is_final` / `is_partial`，展示延迟、置信度。
- 免费额度展示与计时逻辑（本地占位 + API 协议对齐）。
- 技术文档：音频/ASR 模块设计说明、API 调试记录。

### 里程碑 B：Beta（录音库 + AI 交互）
- 列表、详情、筛选、播放、标签管理等录音库功能。
- AI 聊天 & Inquire 集成，含上下文缓存、引用展示。
- 分享/深链初版，实现受邀用户的阅读体验。
- 离线缓存策略、增量同步、崩溃恢复流程。
- QA：关键旅程手动测试脚本，集成测试覆盖登录、录音、字幕、AI 查询。

### 里程碑 C：Release（支付 + App Store 准备）
- Apple Sign-In、Google OAuth 衔接；IAP 订阅购买与收据校验。
- 订阅状态同步、Grace Period 处理、额度恢复流程。
- 推送通知、事件导出、诊断页与日志上传。
- 性能优化（启动、内存、耗电）、无障碍适配、UI 打磨。
- 发布物料：App Store 截图/描述、使用文档、上线清单。

## 4. 工作流与任务拆解
- **认证与账户**：OAuth + 邮箱登录、Token 管理、设备列表、远程登出接口。
- **录音与实时转录**：麦克风权限、前后台录音、音频块 WS 通信、断网缓存与重试、延迟监测。
- **录音库与详情**：分页 API、搜索筛选、本地缓存、波形/播放、说话人编辑、标签操作。
- **AI 交互**：录音内聊天、跨录音搜索、引用渲染、对话持久化。
- **分享与协作**：分享链接创建管理、深链处理、未登录引导。
- **订阅与用量**：额度面板、超限阻断、IAP 购买流程、收据校验与刷新。
- **设置与诊断**：语言主题切换、参数默认值、缓存清理、诊断信息展示。
- **质量保障**：单元/Widget 测试、Golden 测试、端到端脚本、崩溃分析。

## 5. 节奏与协作
- 每周迭代：周一需求拆解&排期，周中同步风险，周五演示与回顾。
- 设计协同：与产品/设计保持 UI 走查，确保语音交互与AI 体验一致。
- 后端接口对齐：维护 OpenAPI 契约，使用 Mock Server 支持前端独立开发。
- 文档与知识库：需求变更、API 变更、技术决策记录在 docs/ 目录。

## 6. 风险与应对
- 流式 ASR 延迟或稳定性：建立灰度环境、指标监控；客户端缓存与退避策略。
- IAP 审核周期：提前准备合规文案，设计备用订阅入口（官网）。
- 多端差异：提前抽象平台层，Alpha 阶段编写 Android 兼容性验证脚本。
- 隐私合规：审计数据采集与日志策略，确保用户授权与数据加密。

## 7. 验收与发布准备
- 验收标准：MVP 核心旅程云测无阻塞、流式字幕延迟 <1.5s、离线转录 30min 音频 <2min。
- Beta 用户反馈收集机制（TestFlight / 内测群）、Crashlytics 与日志监控。
- 发布清单：证书、Provisioning Profile、App Store Connect 元数据、用户指南。

## 8. 后续扩展
- Android 平台适配与多平台支付方案调研。
- 为桌面端提供统一的共享组件库、GraphQL 接口探索。
- 引入语音情感分析、自动摘要多语种支持等增值功能。

